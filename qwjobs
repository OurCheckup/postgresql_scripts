--drop table public."Quaterly_Pivot"
CREATE OR REPLACE FUNCTION quarterlywisejobs()
   RETURNS void as $$
   DECLARE "Quaterly" varchar(30); 
   DECLARE "Quaterly_Final" varchar(30); 
   DECLARE "Quaterly_Pivot" varchar(30); 
	BEGIN
	--create Quarterly table   form maib table device_details
CREATE TABLE public."Quaterly" AS 
TABLE device_details;
--create Quaterly_Final table with Quarterwise from Quaterly table

CREATE TABLE public."Quaterly_Final" AS			 
SELECT id,
device_id ,
sys ,
dia ,
pul ,
date date,
body_weight ,
bmi ,
skeleton ,
fat ,
muscle ,
moisture ,
visceral_fat ,
bmr ,
bodyage ,
heart_rate , 
heart_rate_real_time ,
blood_pressure_up ,
blood_pressure_down ,
blood_oxygen ,
blood_oxygen_real_time ,
ecg ,
steps ,
calories_burt ,
spo2 ,
sleep_minutes ,
sleep_hours ,
deep_sleep ,
shallow_sleep,user_id,WHR,HBA1C,HDL_Cholesterol,LDL_Cholesterol,Total_Cholesterol,Triglycerides,extract(quarter from date) as quarter,extract(year from date) as year   from  public."Quaterly";



--create pivot table from the Quaterly_Final
create table public."Quaterly_Pivot"(vital,values)
as
select  'sys',sys,quarter,year,user_id,date   from  public."Quaterly_Final"
Union all
select  'dia',dia,quarter,year,user_id,date   from  public."Quaterly_Final"
Union all
select  'pul',pul,quarter,year,user_id,date   from  public."Quaterly_Final"
Union all
select 'body_weight',body_weight,quarter,year,user_id,date   from  public."Quaterly_Final"
Union all
select 'bmi',bmi,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'fat',fat,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'muscle',muscle,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'moisture',moisture,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'visceral_fat',visceral_fat,quarter,year,user_id,date   from  public."Quaterly_Final"
Union all
select 'bmr',bmr,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'bodyage',bodyage,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'heart_rate',heart_rate,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'heart_rate_real_time',heart_rate_real_time,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'blood_oxygen',blood_oxygen,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'blood_oxygen_real_time',blood_oxygen_real_time,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'ecg',ecg,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'steps',steps,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'spo2',spo2,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'sleep_minutes',sleep_minutes,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'sleep_hours',sleep_hours,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'deep_sleep',deep_sleep,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'shallow_sleep',shallow_sleep,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'WHR',WHR,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'HBA1C',HBA1C,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'HDL_Cholesterol',HDL_Cholesterol,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'LDL_Cholesterol',LDL_Cholesterol,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'Total_Cholesterol',Total_Cholesterol,quarter,year,user_id,date    from  public."Quaterly_Final"
Union all
select 'Triglycerides',Triglycerides,quarter,year,user_id,date   from  public."Quaterly_Final";

alter table public."Quaterly_Pivot" add column Initial Decimal(10,2);
alter table public."Quaterly_Pivot" add column Target Decimal(10,2);
alter table public."Quaterly_Pivot" add column Achieved Decimal(10,2);
alter table public."Quaterly_Pivot" add column Performance Decimal(10,2);
alter table public."Quaterly_Pivot" add column Normal_count Decimal(10,2);
alter table public."Quaterly_Pivot" add column total_count Decimal(10,2);
alter table public."Quaterly_Pivot" add column target_new Decimal(10,2);

alter table public."Quaterly" add column WHR int;
alter table public."Quaterly" add column HBA1C int;
alter table public."Quaterly" add column HDL_Cholesterol int;
alter table public."Quaterly" add column LDL_Cholesterol int;
alter table public."Quaterly" add column Total_Cholesterol int;
alter table public."Quaterly" add column Triglycerides int;
	--q1
	update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=1)
where Vital='sys' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=1)
where Vital='dia' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=1)
where Vital='sys' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=1)
where Vital='body_weight' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=1)
where Vital='bmi' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=1)
where Vital='skeleton' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=1)
where Vital='fat' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=1)
where Vital='muscle' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=1)
where Vital='moisture' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=1)
where Vital='visceral_fat ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmr ' and quarter=1)
where Vital='bmr ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=1)
where Vital='bodyage ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=1)
where Vital='ecg ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=1)
where Vital='steps ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='calories_burt ' and quarter=1)
where Vital='calories_burt  ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=1)
where Vital='spo2 ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=1)
where Vital='WHR ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=1)
where Vital='HBA1C ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=1)
where Vital='HDL_Cholesterol ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=1)
where Vital='LDL_Cholesterol ' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=1)
where Vital='Total_Cholesterol' and quarter=1 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=1)
where Vital='Triglycerides ' and quarter=1 ;



update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=1 and values >=60 and values<=90)
where Vital='sys' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=1 and values >=60 and values<=90)
where Vital='dia' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=1 and values >=60 and values<=90)
where Vital='body_weight' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot" 
					where vital='heart_rate' and quarter=1 and values >=60 and values<=90)
where Vital='heart_rate' and quarter=1 ; 


update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=1 and values >=60 and values<=90)
where Vital='bmi' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=1 and values >=60 and values<=90)
where Vital='bmr' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=1 and values >=60 and values<=90)
where Vital='spo2' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=1 and values >=60 and values<=90)
where Vital='skelton' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=1 and values >=60 and values<=90)
where Vital='muscle' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=1 and values >=60 and values<=90)
where Vital='fat' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=1 and values >=60 and values<=90)
where Vital='muscle' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=1 and values >=60 and values<=90)
where Vital='moisture' and quarter=1 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='visceral_fat' and quarter=1 and values >=60 and values<=90)
where Vital='visceral_fat ' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=1 and values >=60 and values<=90)
where Vital='ecg' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=1 and values >=60 and values<=90)
where Vital='steps' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=1 and values >=60 and values<=90)
where Vital='WHR' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=1 and values >=60 and values<=90)
where Vital='HBA1C' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=1 and values >=60 and values<=90)
where Vital='HDL_Cholesterol' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=1 and values >=60 and values<=90)
where Vital='LDL_Cholesterol' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=1 and values >=60 and values<=90)
where Vital='Total_Cholesterol' and quarter=1 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=1 and values >=60 and values<=90)
where Vital='Triglycerides' and quarter=1 ;

--SYS
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='sys' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='sys' and quarter=1 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='sys' and quarter=1 ; 
--dia
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='dia' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='dia' and quarter=1 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='dia' and quarter=1 ; 
--body_weight
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='body_weight' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='body_weight' and quarter=1;
--heart_rate
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='heart_rate' and quarter=1 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='heart_rate' and quarter=1 ; 
--bmi
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmi' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='bmi' and quarter=1;
--bmr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmr' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='bmr' and quarter=1;
--visceral_fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='visceral_fat ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='visceral_fat ' and quarter=1;
--skeleton
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='skeleton ' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='skeleton ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='skeleton ' and quarter=1;
--muscle
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='muscle ' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='muscle ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='muscle ' and quarter=1;
--bodyage
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bodyage ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='bodyage ' and quarter=1;
--fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='fat' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='fat ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='fat ' and quarter=1;
--spo2
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='spo2' and quarter=1 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='spo2' and quarter=1 ; 
--whr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='WHR ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='WHR ' and quarter=1;
--hbac1
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HBA1C ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='HBA1C ' and quarter=1;
--HDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HDL_Cholesterol ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='HDL_Cholesterol ' and quarter=1;
--LDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='LDL_Cholesterol ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='LDL_Cholesterol ' and quarter=1;
--Total_Cholesterol
update   public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=1 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='Total_Cholesterol ' and quarter=1   group by vital,date order by date desc limit 1)	
where Vital='Total_Cholesterol ' and quarter=1;

							--q2
update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=2)
where Vital='sys' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=2)
where Vital='dia' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=2)
where Vital='sys' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=2)
where Vital='body_weight' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=2)
where Vital='bmi' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=2)
where Vital='skeleton' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=2)
where Vital='fat' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=2)
where Vital='muscle' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=2)
where Vital='moisture' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=2)
where Vital='visceral_fat ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmr ' and quarter=2)
where Vital='bmr ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=2)
where Vital='bodyage ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=2)
where Vital='ecg ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=2)
where Vital='steps ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='calories_burt ' and quarter=2)
where Vital='calories_burt  ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=2)
where Vital='spo2 ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=2)
where Vital='WHR ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=2)
where Vital='HBA1C ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=2)
where Vital='HDL_Cholesterol ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=2)
where Vital='LDL_Cholesterol ' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=2)
where Vital='Total_Cholesterol' and quarter=2 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=2)
where Vital='Triglycerides ' and quarter=2 ;














update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=2 and values >=60 and values<=90)
where Vital='sys' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=2 and values >=60 and values<=90)
where Vital='dia' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=2 and values >=60 and values<=90)
where Vital='body_weight' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot" 
					where vital='heart_rate' and quarter=2 and values >=60 and values<=90)
where Vital='heart_rate' and quarter=2 ; 


update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=2 and values >=60 and values<=90)
where Vital='bmi' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=2 and values >=60 and values<=90)
where Vital='bmr' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=2 and values >=60 and values<=90)
where Vital='spo2' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=2 and values >=60 and values<=90)
where Vital='skelton' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=2 and values >=60 and values<=90)
where Vital='muscle' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=2 and values >=60 and values<=90)
where Vital='fat' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=2 and values >=60 and values<=90)
where Vital='muscle' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=2 and values >=60 and values<=90)
where Vital='moisture' and quarter=2 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='visceral_fat' and quarter=2 and values >=60 and values<=90)
where Vital='visceral_fat ' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=2 and values >=60 and values<=90)
where Vital='ecg' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=2 and values >=60 and values<=90)
where Vital='steps' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=2 and values >=60 and values<=90)
where Vital='WHR' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=2 and values >=60 and values<=90)
where Vital='HBA1C' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=2 and values >=60 and values<=90)
where Vital='HDL_Cholesterol' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=2 and values >=60 and values<=90)
where Vital='LDL_Cholesterol' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=2 and values >=60 and values<=90)
where Vital='Total_Cholesterol' and quarter=2 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=2 and values >=60 and values<=90)
where Vital='Triglycerides' and quarter=2 ;

--SYS
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='sys' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='sys' and quarter=2 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='sys' and quarter=2 ; 
--dia
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='dia' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='dia' and quarter=2 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='dia' and quarter=2 ; 
--body_weight
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='body_weight' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='body_weight' and quarter=2;
--heart_rate
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='heart_rate' and quarter=2 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='heart_rate' and quarter=2 ; 
--bmi
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmi' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='bmi' and quarter=2;
--bmr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmr' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='bmr' and quarter=2;
--visceral_fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='visceral_fat ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='visceral_fat ' and quarter=2;
--skeleton
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='skeleton ' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='skeleton ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='skeleton ' and quarter=2;
--muscle
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='muscle ' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='muscle ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='muscle ' and quarter=2;
--bodyage
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bodyage ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='bodyage ' and quarter=2;
--fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='fat' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='fat ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='fat ' and quarter=2;
--spo2
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='spo2' and quarter=2 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='spo2' and quarter=2 ; 
--whr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='WHR ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='WHR ' and quarter=2;
--hbac1
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HBA1C ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='HBA1C ' and quarter=2;
--HDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HDL_Cholesterol ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='HDL_Cholesterol ' and quarter=2;
--LDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='LDL_Cholesterol ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='LDL_Cholesterol ' and quarter=2;
--Total_Cholesterol
update   public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=2 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='Total_Cholesterol ' and quarter=2   group by vital,date order by date desc limit 1)	
where Vital='Total_Cholesterol ' and quarter=2;
							
							--q3
update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=3)
where Vital='sys' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=3)
where Vital='dia' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=3)
where Vital='sys' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=3)
where Vital='body_weight' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=3)
where Vital='bmi' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=3)
where Vital='skeleton' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=3)
where Vital='fat' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=3)
where Vital='muscle' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=3)
where Vital='moisture' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=3)
where Vital='visceral_fat ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmr ' and quarter=3)
where Vital='bmr ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=3)
where Vital='bodyage ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=3)
where Vital='ecg ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=3)
where Vital='steps ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='calories_burt ' and quarter=3)
where Vital='calories_burt  ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=3)
where Vital='spo2 ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=3)
where Vital='WHR ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=3)
where Vital='HBA1C ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=3)
where Vital='HDL_Cholesterol ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=3)
where Vital='LDL_Cholesterol ' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=3)
where Vital='Total_Cholesterol' and quarter=3 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=3)
where Vital='Triglycerides ' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=3 and values >=60 and values<=90)
where Vital='sys' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=3 and values >=60 and values<=90)
where Vital='dia' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=3 and values >=60 and values<=90)
where Vital='body_weight' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot" 
					where vital='heart_rate' and quarter=3 and values >=60 and values<=90)
where Vital='heart_rate' and quarter=3 ; 


update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=3 and values >=60 and values<=90)
where Vital='bmi' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=3 and values >=60 and values<=90)
where Vital='bmr' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=3 and values >=60 and values<=90)
where Vital='spo2' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=3 and values >=60 and values<=90)
where Vital='skelton' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=3 and values >=60 and values<=90)
where Vital='muscle' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=3 and values >=60 and values<=90)
where Vital='fat' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=3 and values >=60 and values<=90)
where Vital='muscle' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=3 and values >=60 and values<=90)
where Vital='moisture' and quarter=3 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='visceral_fat' and quarter=3 and values >=60 and values<=90)
where Vital='visceral_fat ' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=3 and values >=60 and values<=90)
where Vital='ecg' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=3 and values >=60 and values<=90)
where Vital='steps' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=3 and values >=60 and values<=90)
where Vital='WHR' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=3 and values >=60 and values<=90)
where Vital='HBA1C' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=3 and values >=60 and values<=90)
where Vital='HDL_Cholesterol' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=3 and values >=60 and values<=90)
where Vital='LDL_Cholesterol' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=3 and values >=60 and values<=90)
where Vital='Total_Cholesterol' and quarter=3 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=3 and values >=60 and values<=90)
where Vital='Triglycerides' and quarter=3 ;

--SYS
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='sys' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='sys' and quarter=3 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='sys' and quarter=3 ; 
--dia
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='dia' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='dia' and quarter=3 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='dia' and quarter=3 ; 
--body_weight
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='body_weight' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='body_weight' and quarter=3;
--heart_rate
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='heart_rate' and quarter=3 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='heart_rate' and quarter=3 ; 
--bmi
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmi' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='bmi' and quarter=3;
--bmr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmr' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='bmr' and quarter=3;
--visceral_fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='visceral_fat ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='visceral_fat ' and quarter=3;
--skeleton
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='skeleton ' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='skeleton ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='skeleton ' and quarter=3;
--muscle
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='muscle ' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='muscle ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='muscle ' and quarter=3;
--bodyage
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bodyage ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='bodyage ' and quarter=3;
--fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='fat' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='fat ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='fat ' and quarter=3;
--spo2
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='spo2' and quarter=3 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='spo2' and quarter=3 ; 
--whr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='WHR ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='WHR ' and quarter=3;
--hbac1
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HBA1C ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='HBA1C ' and quarter=3;
--HDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HDL_Cholesterol ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='HDL_Cholesterol ' and quarter=3;
--LDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='LDL_Cholesterol ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='LDL_Cholesterol ' and quarter=3;
--Total_Cholesterol
update   public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=3 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='Total_Cholesterol ' and quarter=3   group by vital,date order by date desc limit 1)	
where Vital='Total_Cholesterol ' and quarter=3;
							
							--q4
update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=4)
where Vital='sys' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=4)
where Vital='dia' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=4)
where Vital='sys' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=4)
where Vital='body_weight' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=4)
where Vital='bmi' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=4)
where Vital='skeleton' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=4)
where Vital='fat' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=4)
where Vital='muscle' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=4)
where Vital='moisture' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=4)
where Vital='visceral_fat ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bmr ' and quarter=4)
where Vital='bmr ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=4)
where Vital='bodyage ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=4)
where Vital='ecg ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=4)
where Vital='steps ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='calories_burt ' and quarter=4)
where Vital='calories_burt  ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=4)
where Vital='spo2 ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=4)
where Vital='WHR ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=4)
where Vital='HBA1C ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=4)
where Vital='HDL_Cholesterol ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=4)
where Vital='LDL_Cholesterol ' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=4)
where Vital='Total_Cholesterol' and quarter=4 ;

update public."Quaterly_Pivot" 
set total_count = (SELECT count(values) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=4)
where Vital='Triglycerides ' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='sys' and quarter=4 and values >=60 and values<=90)
where Vital='sys' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='dia' and quarter=4 and values >=60 and values<=90)
where Vital='dia' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=4 and values >=60 and values<=90)
where Vital='body_weight' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot" 
					where vital='heart_rate' and quarter=4 and values >=60 and values<=90)
where Vital='heart_rate' and quarter=4 ; 


update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=4 and values >=60 and values<=90)
where Vital='bmi' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=4 and values >=60 and values<=90)
where Vital='bmr' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=4 and values >=60 and values<=90)
where Vital='spo2' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='skeleton' and quarter=4 and values >=60 and values<=90)
where Vital='skelton' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=4 and values >=60 and values<=90)
where Vital='muscle' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='fat' and quarter=4 and values >=60 and values<=90)
where Vital='fat' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='muscle' and quarter=4 and values >=60 and values<=90)
where Vital='muscle' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='moisture' and quarter=4 and values >=60 and values<=90)
where Vital='moisture' and quarter=4 ; 

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='visceral_fat' and quarter=4 and values >=60 and values<=90)
where Vital='visceral_fat ' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='ecg' and quarter=4 and values >=60 and values<=90)
where Vital='ecg' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='steps' and quarter=4 and values >=60 and values<=90)
where Vital='steps' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=4 and values >=60 and values<=90)
where Vital='WHR' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=4 and values >=60 and values<=90)
where Vital='HBA1C' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=4 and values >=60 and values<=90)
where Vital='HDL_Cholesterol' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=4 and values >=60 and values<=90)
where Vital='LDL_Cholesterol' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=4 and values >=60 and values<=90)
where Vital='Total_Cholesterol' and quarter=4 ;

update public."Quaterly_Pivot" 
set Normal_Count = (SELECT count(Normal_Count) FROM public."Quaterly_Pivot"  where vital='Triglycerides' and quarter=4 and values >=60 and values<=90)
where Vital='Triglycerides' and quarter=4 ;

--SYS
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='sys' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='sys' and quarter=4 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='sys' and quarter=4 ; 
--dia
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='dia' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='dia' and quarter=4 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='dia' and quarter=4 ; 
--body_weight
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='body_weight' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='body_weight' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='body_weight' and quarter=4;
--heart_rate
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='heart_rate' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='heart_rate' and quarter=4 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='heart_rate' and quarter=4 ; 
--bmi
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmi' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmi' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='bmi' and quarter=4;
--bmr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bmr' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bmr' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='bmr' and quarter=4;
--visceral_fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='visceral_fat ' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='visceral_fat ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='visceral_fat ' and quarter=4;
--skeleton
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='skeleton ' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='skeleton ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='skeleton ' and quarter=4;
--muscle
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='muscle ' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='muscle ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='muscle ' and quarter=4;
--bodyage
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='bodyage' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='bodyage ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='bodyage ' and quarter=4;
--fat
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='fat' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='fat ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='fat ' and quarter=4;
--spo2
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='spo2' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='spo2' and quarter=4 and values >=60 and values<=90   group by vital,date order by date desc limit 1)	
where Vital='spo2' and quarter=4 ; 
--whr
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='WHR' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='WHR ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='WHR ' and quarter=4;
--hbac1
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HBA1C' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HBA1C ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='HBA1C ' and quarter=4;
--HDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='HDL_Cholesterol' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='HDL_Cholesterol ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='HDL_Cholesterol ' and quarter=4;
--LDL_Cholesterol
update public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='LDL_Cholesterol' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='LDL_Cholesterol ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='LDL_Cholesterol ' and quarter=4;
--Total_Cholesterol
update   public."Quaterly_Pivot" 
set Initial = (SELECT ROUND(avg(values))  FROM public."Quaterly_Pivot"  where vital='Total_Cholesterol' and quarter=4 group by vital),
    achieved= (select ROUND(avg(values))  FROM public."Quaterly_Pivot" where Vital='Total_Cholesterol ' and quarter=4   group by vital,date order by date desc limit 1)	
where Vital='Total_Cholesterol ' and quarter=4;
							
END;
$$ LANGUAGE plpgsql;
		
   --select fit()
