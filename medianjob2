--select medianjob2();
CREATE OR REPLACE FUNCTION medianjob2()
   RETURNS void as $$
   Declare "device_agg_final_weekly" varchar(30);
   Declare "device_agg_final_monthly" varchar(30);
   Declare "device_agg_final_daily" varchar(30);
   
   
   begin
   --median
   

  

--delete  from device_agg_final_weekly 
 insert into device_agg_final_weekly 
select w.user_id,w.week, w.device_id,w.sys ,
w.dia ,
w.pul ,
w.body_weight ,
w.bmi ,
w.skeleton ,
w.fat ,
w.muscle ,
w.moisture ,
w.visceral_fat ,
w.bmr ,
w.bodyage ,
w.heart_rate , 
w.heart_rate_real_time ,
w.blood_pressure_up ,
w.blood_pressure_down ,
w.blood_oxygen ,
w.blood_oxygen_real_time ,
w.ecg ,
w.steps ,
w.calories_burt ,
w.spo2 ,
w.sleep_minutes ,
w.sleep_hours ,
w.deep_sleep ,
w.shallow_sleep,
w.min_sys ,
w.min_dia ,
w.min_pul ,
w.min_body_weight ,
w.min_skeleton ,
w.min_fat ,
w.min_muscle ,
w.min_moisture ,
w.min_visceral_fat ,
w.min_bmr ,
w.min_bodyage ,
w.min_heart_rate , 
w.min_heart_rate_real_time ,
w.min_blood_pressure_up ,
w.min_blood_pressure_down ,
w.min_blood_oxygen ,
w.min_blood_oxygen_real_time ,
w.min_ecg ,
w.min_steps ,
w.min_calories_burt ,
w.min_spo2 ,
w.min_sleep_minutes ,
w.min_sleep_hours ,
w.min_deep_sleep ,
w.min_shallow_sleep,
w.max_sys ,
w.max_dia ,
w.max_pul ,
w.max_body_weight ,
w.max_bmi ,
w.max_skeleton ,
w.max_fat ,
w.max_muscle ,
w.max_moisture ,
w.max_visceral_fat ,
w.max_bmr ,
w.max_bodyage ,
w.max_heart_rate , 
w.max_heart_rate_real_time ,
w.max_blood_pressure_up ,
w.max_blood_pressure_down ,
w.max_blood_oxygen ,
w.max_blood_oxygen_real_time ,
w.max_ecg ,
w.max_steps ,
w.max_calories_burt ,
w.max_spo2 ,
w.max_sleep_minutes ,
w.max_sleep_hours ,
w.max_deep_sleep ,
w.max_shallow_sleep,
m.median_sys ,
m.median_dia ,
m.median_body_weight ,
m.median_bmi ,
m.median_skeleton ,
m.median_fat ,
m.median_muscle ,
m.median_moisture ,
m.median_visceral_fat ,
m.median_bmr ,
m.median_bodyage ,
m.median_heart_rate , 
m.median_heart_rate_real_time ,
m.median_blood_pressure_up ,
m.median_blood_pressure_down ,
m.median_blood_oxygen ,
m.median_blood_oxygen_real_time ,
m.median_ecg ,
m.median_steps ,
m.median_calories_burt ,
m.median_spo2 ,
m.median_sleep_minutes ,
m.median_sleep_hours ,
m.median_deep_sleep ,
m.median_shallow_sleep,
mo.mode_sys ,
mo.mode_dia ,
mo.mode_pul ,
mo.mode_body_weight ,
mo.mode_bmi ,
mo.mode_skeleton ,
mo.mode_fat ,
mo.mode_muscle ,
mo.mode_moisture ,
mo.mode_visceral_fat ,
mo.mode_bmr ,
mo.mode_bodyage ,
mo.mode_heart_rate , 
mo.mode_heart_rate_real_time ,
mo.mode_blood_pressure_up ,
mo.mode_blood_pressure_down ,
mo.mode_blood_oxygen ,
mo.mode_blood_oxygen_real_time ,
mo.mode_ecg ,
mo.mode_steps ,
mo.mode_calories_burt ,
mo.mode_spo2 ,
mo.mode_sleep_minutes ,
mo.mode_sleep_hours ,
mo.mode_deep_sleep ,
mo.mode_shallow_sleep   from public.device_agg_weekly as w
inner  join median as m  on w.user_id=m.user_id and w.device_id=m.device_id and w.week=m.week
inner  join mode as mo on mo.user_id=w.user_id and mo.device_id=w.device_id and mo.week=w.week where 
w.user_id not in (select distinct user_id from device_agg_final_weekly) 
		 --select * from public.device_agg_weekly where user_id = 411 and week = '20-2019'
group by w.user_id,w.week, w.device_id,w.sys ,
w.dia ,
w.pul ,
w.body_weight ,
w.bmi ,
w.skeleton ,
w.fat ,
w.muscle ,
w.moisture ,
w.visceral_fat ,
w.bmr ,
w.bodyage ,
w.heart_rate , 
w.heart_rate_real_time ,
w.blood_pressure_up ,
w.blood_pressure_down ,
w.blood_oxygen ,
w.blood_oxygen_real_time ,
w.ecg ,
w.steps ,
w.calories_burt ,
w.spo2 ,
w.sleep_minutes ,
w.sleep_hours ,
w.deep_sleep ,
w.shallow_sleep,
w.min_sys ,
w.min_dia ,
w.min_pul ,
w.min_body_weight ,
w.min_skeleton ,
w.min_fat ,
w.min_muscle ,
w.min_moisture ,
w.min_visceral_fat ,
w.min_bmr ,
w.min_bodyage ,
w.min_heart_rate , 
w.min_heart_rate_real_time ,
w.min_blood_pressure_up ,
w.min_blood_pressure_down ,
w.min_blood_oxygen ,
w.min_blood_oxygen_real_time ,
w.min_ecg ,
w.min_steps ,
w.min_calories_burt ,
w.min_spo2 ,
w.min_sleep_minutes ,
w.min_sleep_hours ,
w.min_deep_sleep ,
w.min_shallow_sleep,
w.max_sys ,
w.max_dia ,
w.max_pul ,
w.max_body_weight ,
w.max_bmi ,
w.max_skeleton ,
w.max_fat ,
w.max_muscle ,
w.max_moisture ,
w.max_visceral_fat ,
w.max_bmr ,
w.max_bodyage ,
w.max_heart_rate , 
w.max_heart_rate_real_time ,
w.max_blood_pressure_up ,
w.max_blood_pressure_down ,
w.max_blood_oxygen ,
w.max_blood_oxygen_real_time ,
w.max_ecg ,
w.max_steps ,
w.max_calories_burt ,
w.max_spo2 ,
w.max_sleep_minutes ,
w.max_sleep_hours ,
w.max_deep_sleep ,
w.max_shallow_sleep,
m.median_sys ,
m.median_dia ,
m.median_body_weight ,
m.median_bmi ,
m.median_skeleton ,
m.median_fat ,
m.median_muscle ,
m.median_moisture ,
m.median_visceral_fat ,
m.median_bmr ,
m.median_bodyage ,
m.median_heart_rate , 
m.median_heart_rate_real_time ,
m.median_blood_pressure_up ,
m.median_blood_pressure_down ,
m.median_blood_oxygen ,
m.median_blood_oxygen_real_time ,
m.median_ecg ,
m.median_steps ,
m.median_calories_burt ,
m.median_spo2 ,
m.median_sleep_minutes ,
m.median_sleep_hours ,
m.median_deep_sleep ,
m.median_shallow_sleep,
mo.mode_sys ,
mo.mode_dia ,
mo.mode_pul ,
mo.mode_body_weight ,
mo.mode_bmi ,
mo.mode_skeleton ,
mo.mode_fat ,
mo.mode_muscle ,
mo.mode_moisture ,
mo.mode_visceral_fat ,
mo.mode_bmr ,
mo.mode_bodyage ,
mo.mode_heart_rate , 
mo.mode_heart_rate_real_time ,
mo.mode_blood_pressure_up ,
mo.mode_blood_pressure_down ,
mo.mode_blood_oxygen ,
mo.mode_blood_oxygen_real_time ,
mo.mode_ecg ,
mo.mode_steps ,
mo.mode_calories_burt ,
mo.mode_spo2 ,
mo.mode_sleep_minutes ,
mo.mode_sleep_hours ,
mo.mode_deep_sleep ,
mo.mode_shallow_sleep;


 
 
 insert into device_agg_final_monthly 
Select w.user_id,w.month, w.device_id,w.sys ,
w.dia ,
w.pul ,
w.body_weight ,
w.bmi ,
w.skeleton ,
w.fat ,
w.muscle ,
w.moisture ,
w.visceral_fat ,
w.bmr ,
w.bodyage ,
w.heart_rate , 
w.heart_rate_real_time ,
w.blood_pressure_up ,
w.blood_pressure_down ,
w.blood_oxygen ,
w.blood_oxygen_real_time ,
w.ecg ,
w.steps ,
w.calories_burt ,
w.spo2 ,
w.sleep_minutes ,
w.sleep_hours ,
w.deep_sleep ,
w.shallow_sleep,
w.min_sys ,
w.min_dia ,
w.min_pul ,
w.min_body_weight ,
w.min_skeleton ,
w.min_fat ,
w.min_muscle ,
w.min_moisture ,
w.min_visceral_fat ,
w.min_bmr ,
w.min_bodyage ,
w.min_heart_rate , 
w.min_heart_rate_real_time ,
w.min_blood_pressure_up ,
w.min_blood_pressure_down ,
w.min_blood_oxygen ,
w.min_blood_oxygen_real_time ,
w.min_ecg ,
w.min_steps ,
w.min_calories_burt ,
w.min_spo2 ,
w.min_sleep_minutes ,
w.min_sleep_hours ,
w.min_deep_sleep ,
w.min_shallow_sleep,
w.max_sys ,
w.max_dia ,
w.max_pul ,
w.max_body_weight ,
w.max_bmi ,
w.max_skeleton ,
w.max_fat ,
w.max_muscle ,
w.max_moisture ,
w.max_visceral_fat ,
w.max_bmr ,
w.max_bodyage ,
w.max_heart_rate , 
w.max_heart_rate_real_time ,
w.max_blood_pressure_up ,
w.max_blood_pressure_down ,
w.max_blood_oxygen ,
w.max_blood_oxygen_real_time ,
w.max_ecg ,
w.max_steps ,
w.max_calories_burt ,
w.max_spo2 ,
w.max_sleep_minutes ,
w.max_sleep_hours ,
w.max_deep_sleep ,
w.max_shallow_sleep,
m.median_sys ,
m.median_dia ,
m.median_body_weight ,
m.median_bmi ,
m.median_skeleton ,
m.median_fat ,
m.median_muscle ,
m.median_moisture ,
m.median_visceral_fat ,
m.median_bmr ,
m.median_bodyage ,
m.median_heart_rate , 
m.median_heart_rate_real_time ,
m.median_blood_pressure_up ,
m.median_blood_pressure_down ,
m.median_blood_oxygen ,
m.median_blood_oxygen_real_time ,
m.median_ecg ,
m.median_steps ,
m.median_calories_burt ,
m.median_spo2 ,
m.median_sleep_minutes ,
m.median_sleep_hours ,
m.median_deep_sleep ,
m.median_shallow_sleep,
mo.mode_sys ,
mo.mode_dia ,
mo.mode_pul ,
mo.mode_body_weight ,
mo.mode_bmi ,
mo.mode_skeleton ,
mo.mode_fat ,
mo.mode_muscle ,
mo.mode_moisture ,
mo.mode_visceral_fat ,
mo.mode_bmr ,
mo.mode_bodyage ,
mo.mode_heart_rate , 
mo.mode_heart_rate_real_time ,
mo.mode_blood_pressure_up ,
mo.mode_blood_pressure_down ,
mo.mode_blood_oxygen ,
mo.mode_blood_oxygen_real_time ,
mo.mode_ecg ,
mo.mode_steps ,
mo.mode_calories_burt ,
mo.mode_spo2 ,
mo.mode_sleep_minutes ,
mo.mode_sleep_hours ,
mo.mode_deep_sleep ,
mo.mode_shallow_sleep  from public.device_agg_monthly as w
inner  join med as m  on w.user_id=m.user_id and w.device_id=m.device_id and w.Month=m.Month
inner  join mod as mo on mo.user_id=w.user_id and mo.device_id=w.device_id and mo.Month=w.Month  where 
w.user_id not in (select distinct user_id from device_agg_final_monthly)
group by w.user_id,w.month, w.device_id,w.sys ,
w.dia ,
w.pul ,
w.body_weight ,
w.bmi ,
w.skeleton ,
w.fat ,
w.muscle ,
w.moisture ,
w.visceral_fat ,
w.bmr ,
w.bodyage ,
w.heart_rate , 
w.heart_rate_real_time ,
w.blood_pressure_up ,
w.blood_pressure_down ,
w.blood_oxygen ,
w.blood_oxygen_real_time ,
w.ecg ,
w.steps ,
w.calories_burt ,
w.spo2 ,
w.sleep_minutes ,
w.sleep_hours ,
w.deep_sleep ,
w.shallow_sleep,
w.min_sys ,
w.min_dia ,
w.min_pul ,
w.min_body_weight ,
w.min_skeleton ,
w.min_fat ,
w.min_muscle ,
w.min_moisture ,
w.min_visceral_fat ,
w.min_bmr ,
w.min_bodyage ,
w.min_heart_rate , 
w.min_heart_rate_real_time ,
w.min_blood_pressure_up ,
w.min_blood_pressure_down ,
w.min_blood_oxygen ,
w.min_blood_oxygen_real_time ,
w.min_ecg ,
w.min_steps ,
w.min_calories_burt ,
w.min_spo2 ,
w.min_sleep_minutes ,
w.min_sleep_hours ,
w.min_deep_sleep ,
w.min_shallow_sleep,
w.max_sys ,
w.max_dia ,
w.max_pul ,
w.max_body_weight ,
w.max_bmi ,
w.max_skeleton ,
w.max_fat ,
w.max_muscle ,
w.max_moisture ,
w.max_visceral_fat ,
w.max_bmr ,
w.max_bodyage ,
w.max_heart_rate , 
w.max_heart_rate_real_time ,
w.max_blood_pressure_up ,
w.max_blood_pressure_down ,
w.max_blood_oxygen ,
w.max_blood_oxygen_real_time ,
w.max_ecg ,
w.max_steps ,
w.max_calories_burt ,
w.max_spo2 ,
w.max_sleep_minutes ,
w.max_sleep_hours ,
w.max_deep_sleep ,
w.max_shallow_sleep,
m.median_sys ,
m.median_dia ,
m.median_body_weight ,
m.median_bmi ,
m.median_skeleton ,
m.median_fat ,
m.median_muscle ,
m.median_moisture ,
m.median_visceral_fat ,
m.median_bmr ,
m.median_bodyage ,
m.median_heart_rate , 
m.median_heart_rate_real_time ,
m.median_blood_pressure_up ,
m.median_blood_pressure_down ,
m.median_blood_oxygen ,
m.median_blood_oxygen_real_time ,
m.median_ecg ,
m.median_steps ,
m.median_calories_burt ,
m.median_spo2 ,
m.median_sleep_minutes ,
m.median_sleep_hours ,
m.median_deep_sleep ,
m.median_shallow_sleep,
mo.mode_sys ,
mo.mode_dia ,
mo.mode_pul ,
mo.mode_body_weight ,
mo.mode_bmi ,
mo.mode_skeleton ,
mo.mode_fat ,
mo.mode_muscle ,
mo.mode_moisture ,
mo.mode_visceral_fat ,
mo.mode_bmr ,
mo.mode_bodyage ,
mo.mode_heart_rate , 
mo.mode_heart_rate_real_time ,
mo.mode_blood_pressure_up ,
mo.mode_blood_pressure_down ,
mo.mode_blood_oxygen ,
mo.mode_blood_oxygen_real_time ,
mo.mode_ecg ,
mo.mode_steps ,
mo.mode_calories_burt ,
mo.mode_spo2 ,
mo.mode_sleep_minutes ,
mo.mode_sleep_hours ,
mo.mode_deep_sleep ,
mo.mode_shallow_sleep;

insert into device_agg_final_daily 
select w.user_id,w.day, w.device_id,w.sys ,
w.dia ,
w.pul ,
w.body_weight ,
w.bmi ,
w.skeleton ,
w.fat ,
w.muscle ,
w.moisture ,
w.visceral_fat ,
w.bmr ,
w.bodyage ,
w.heart_rate , 
w.heart_rate_real_time ,
w.blood_pressure_up ,
w.blood_pressure_down ,
w.blood_oxygen ,
w.blood_oxygen_real_time ,
w.ecg ,
w.steps ,
w.calories_burt ,
w.spo2 ,
w.sleep_minutes ,
w.sleep_hours ,
w.deep_sleep ,
w.shallow_sleep,
w.min_sys ,
w.min_dia ,
w.min_pul ,
w.min_body_weight ,
w.min_skeleton ,
w.min_fat ,
w.min_muscle ,
w.min_moisture ,
w.min_visceral_fat ,
w.min_bmr ,
w.min_bodyage ,
w.min_heart_rate , 
w.min_heart_rate_real_time ,
w.min_blood_pressure_up ,
w.min_blood_pressure_down ,
w.min_blood_oxygen ,
w.min_blood_oxygen_real_time ,
w.min_ecg ,
w.min_steps ,
w.min_calories_burt ,
w.min_spo2 ,
w.min_sleep_minutes ,
w.min_sleep_hours ,
w.min_deep_sleep ,
w.min_shallow_sleep,
w.max_sys ,
w.max_dia ,
w.max_pul ,
w.max_body_weight ,
w.max_bmi ,
w.max_skeleton ,
w.max_fat ,
w.max_muscle ,
w.max_moisture ,
w.max_visceral_fat ,
w.max_bmr ,
w.max_bodyage ,
w.max_heart_rate , 
w.max_heart_rate_real_time ,
w.max_blood_pressure_up ,
w.max_blood_pressure_down ,
w.max_blood_oxygen ,
w.max_blood_oxygen_real_time ,
w.max_ecg ,
w.max_steps ,
w.max_calories_burt ,
w.max_spo2 ,
w.max_sleep_minutes ,
w.max_sleep_hours ,
w.max_deep_sleep ,
w.max_shallow_sleep,
m.median_sys ,
m.median_dia ,
m.median_body_weight ,
m.median_bmi ,
m.median_skeleton ,
m.median_fat ,
m.median_muscle ,
m.median_moisture ,
m.median_visceral_fat ,
m.median_bmr ,
m.median_bodyage ,
m.median_heart_rate , 
m.median_heart_rate_real_time ,
m.median_blood_pressure_up ,
m.median_blood_pressure_down ,
m.median_blood_oxygen ,
m.median_blood_oxygen_real_time ,
m.median_ecg ,
m.median_steps ,
m.median_calories_burt ,
m.median_spo2 ,
m.median_sleep_minutes ,
m.median_sleep_hours ,
m.median_deep_sleep ,
m.median_shallow_sleep,
mo.mode_sys ,
mo.mode_dia ,
mo.mode_pul ,
mo.mode_body_weight ,
mo.mode_bmi ,
mo.mode_skeleton ,
mo.mode_fat ,
mo.mode_muscle ,
mo.mode_moisture ,
mo.mode_visceral_fat ,
mo.mode_bmr ,
mo.mode_bodyage ,
mo.mode_heart_rate , 
mo.mode_heart_rate_real_time ,
mo.mode_blood_pressure_up ,
mo.mode_blood_pressure_down ,
mo.mode_blood_oxygen ,
mo.mode_blood_oxygen_real_time ,
mo.mode_ecg ,
mo.mode_steps ,
mo.mode_calories_burt ,
mo.mode_spo2 ,
mo.mode_sleep_minutes ,
mo.mode_sleep_hours ,
mo.mode_deep_sleep ,
mo.mode_shallow_sleep  from public.device_agg_daily as w
inner  join med3 as m  on w.user_id=m.user_id and w.device_id=m.device_id and w.day=m.daY
inner  join mod3 as mo on mo.user_id=w.user_id and mo.device_id=w.device_id and mo.day=w.day where w.user_id not in (select distinct user_id from device_agg_final_daily)
group by w.user_id,w.day, w.device_id,w.sys ,
w.dia ,
w.pul ,
w.body_weight ,
w.bmi ,
w.skeleton ,
w.fat ,
w.muscle ,
w.moisture ,
w.visceral_fat ,
w.bmr ,
w.bodyage ,
w.heart_rate , 
w.heart_rate_real_time ,
w.blood_pressure_up ,
w.blood_pressure_down ,
w.blood_oxygen ,
w.blood_oxygen_real_time ,
w.ecg ,
w.steps ,
w.calories_burt ,
w.spo2 ,
w.sleep_minutes ,
w.sleep_hours ,
w.deep_sleep ,
w.shallow_sleep,
w.min_sys ,
w.min_dia ,
w.min_pul ,
w.min_body_weight ,
w.min_skeleton ,
w.min_fat ,
w.min_muscle ,
w.min_moisture ,
w.min_visceral_fat ,
w.min_bmr ,
w.min_bodyage ,
w.min_heart_rate , 
w.min_heart_rate_real_time ,
w.min_blood_pressure_up ,
w.min_blood_pressure_down ,
w.min_blood_oxygen ,
w.min_blood_oxygen_real_time ,
w.min_ecg ,
w.min_steps ,
w.min_calories_burt ,
w.min_spo2 ,
w.min_sleep_minutes ,
w.min_sleep_hours ,
w.min_deep_sleep ,
w.min_shallow_sleep,
w.max_sys ,
w.max_dia ,
w.max_pul ,
w.max_body_weight ,
w.max_bmi ,
w.max_skeleton ,
w.max_fat ,
w.max_muscle ,
w.max_moisture ,
w.max_visceral_fat ,
w.max_bmr ,
w.max_bodyage ,
w.max_heart_rate , 
w.max_heart_rate_real_time ,
w.max_blood_pressure_up ,
w.max_blood_pressure_down ,
w.max_blood_oxygen ,
w.max_blood_oxygen_real_time ,
w.max_ecg ,
w.max_steps ,
w.max_calories_burt ,
w.max_spo2 ,
w.max_sleep_minutes ,
w.max_sleep_hours ,
w.max_deep_sleep ,
w.max_shallow_sleep,
m.median_sys ,
m.median_dia ,
m.median_body_weight ,
m.median_bmi ,
m.median_skeleton ,
m.median_fat ,
m.median_muscle ,
m.median_moisture ,
m.median_visceral_fat ,
m.median_bmr ,
m.median_bodyage ,
m.median_heart_rate , 
m.median_heart_rate_real_time ,
m.median_blood_pressure_up ,
m.median_blood_pressure_down ,
m.median_blood_oxygen ,
m.median_blood_oxygen_real_time ,
m.median_ecg ,
m.median_steps ,
m.median_calories_burt ,
m.median_spo2 ,
m.median_sleep_minutes ,
m.median_sleep_hours ,
m.median_deep_sleep ,
m.median_shallow_sleep,
mo.mode_sys ,
mo.mode_dia ,
mo.mode_pul ,
mo.mode_body_weight ,
mo.mode_bmi ,
mo.mode_skeleton ,
mo.mode_fat ,
mo.mode_muscle ,
mo.mode_moisture ,
mo.mode_visceral_fat ,
mo.mode_bmr ,
mo.mode_bodyage ,
mo.mode_heart_rate , 
mo.mode_heart_rate_real_time ,
mo.mode_blood_pressure_up ,
mo.mode_blood_pressure_down ,
mo.mode_blood_oxygen ,
mo.mode_blood_oxygen_real_time ,
mo.mode_ecg ,
mo.mode_steps ,
mo.mode_calories_burt ,
mo.mode_spo2 ,
mo.mode_sleep_minutes ,
mo.mode_sleep_hours ,
mo.mode_deep_sleep ,
mo.mode_shallow_sleep;

END;
$$ LANGUAGE plpgsql;



